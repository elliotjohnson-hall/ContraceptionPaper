---
output:
  word_document: default
  html_document: default
---
```{r}
#Table3 Data
CompareTimes <- function(group) {
  Lockdown <- CompleteDataset %>%
    filter(Lockdown == "Y",
           Group == glue("{group}")) %>%
    reframe(Sum = sum(MonthsContraception) / Months) %>%
    unique()
  PostLockdown <- CompleteDataset %>%
    filter(Lockdown == "N",
           Period == "3",
           Group == glue("{group}")) %>%
    reframe(Sum = sum(MonthsContraception) / Months) %>%
    unique()
  PreLockdown <- CompleteDataset %>%
    filter(Lockdown == "N",
           Period == "1",
           Group == glue("{group}")) %>%
    reframe(Sum = sum(MonthsContraception) / Months) %>%
    unique()
  PeriLockdown <- CompleteDataset %>%
    filter(Lockdown == "N",
           Period == "2",
           Group == glue("{group}")) %>%
    reframe(Sum = sum(MonthsContraception) / Months) %>%
    unique()

  return(unlist(
    c(
      Lockdown / PreLockdown,
      PeriLockdown / PreLockdown,
      PostLockdown / PreLockdown
    )
  ))
}


#Table3
Table3 <-
  tibble(
    "Timeframes" = c("Lockdown", "Peri-Lockdown", "Post-Lockdown"),
    "All LARC" = CompareTimes("LARC"),
    "IUS" = CompareTimesTypes("IUS"),
    "IUD" = CompareTimesTypes("IUD"),
    "Implant" = CompareTimesTypes("Implant"),
    "Injection" = CompareTimesTypes("Injection"),
    "All Oral" = CompareTimes("Oral"),
    "COCP" = CompareTimesTypes("COCP"),
    "POP" = CompareTimesTypes("POP"),
    "All Other" = CompareTimes("Other"),
    "Patch" = CompareTimesTypes("Patch"),
    "Ring" = CompareTimesTypes("Ring"),
    "All EC" = CompareTimesEC("EC"),
    "Uli" = CompareTimesECTypes("ULI"),
    "Levo" = CompareTimesECTypes("LEV")
  ) %>%
  gt() %>%
  fmt_percent(decimals = 2) %>%
  tab_spanner(label = "LARCs", columns = c("All LARC":"Injection")) %>%
  tab_spanner(label = "Oral", columns = c("All Oral":"POP")) %>%
  tab_spanner(label = "Other", columns = c("All Other":"Ring")) %>%
  tab_spanner(label = "EC", columns = c("All EC":"Levo")) %>%
  tab_style(locations = cells_body(columns = c("All LARC", "All Other", "All Oral", "All EC")),
            style = list(cell_text(weight = "bold"), cell_fill(color = "grey80")))
Table3
```

